# EOSS Bot

ЭОСС — Электронный ОСС.

Проведение ОСС — чудовищно трудозатратная и дорогая операция. Перед тем как её проводить хочется наверняка знать, что всё не зря. Обходы жителей ногами — это тяжело. Опросы в Телеграме "в лоб" дают никакую информацию, т.к. не учитывают кто чем владеет и позволяют голосовать левым людям.

Наш бот позволяет провести "черновую" операцию опроса практически даром через телеграм, чтобы понять какие шансы у планируемого ОСС и по необходимости предпринять какие-то действия.

Незаменимый помощник старших по подъездам, управляющих компаний и ТСЖ.

# Installation

- Python3
- Django
- какая-то либа про Telegram (в django-app/requirements.txt прописано что может быть, но предстоит уточнить)

1. Установить переменную окружения `API_KEY` с ключом для тележного бота
2. Добавить бота в тестовую группу
3. Выполнить миграции `python3 manage.py migrate`, чтобы появилась база `db.sqlite3` с нужной схемой
4. Руками прописать минимальный сет данных в `db.sqlite3`:

4.1. в таблицу `tbot_estate` прока что РУЧКАМИ вписать инфу об объектах недвижимости, типа

```sqlite-sql
insert into tbot_estate (id, estate_code, _total_real_space, users_and_weights) values (1, 'P1', 10.0, '[{"user_id":1,"weight":10}]');
insert into tbot_estate (id, estate_code, _total_real_space, users_and_weights) values (2, 'P2', 10.0, '[{"user_id":2,"weight":10}]');
```

Пояснения:
- `estate_code` — условный код объекта недвижимости. Номер квартиры, номер паркинга, либо номер кладовки. Имеет смысл разделять префиксами, например, kv123, par123, klad123
- `_total_real_space` — площадь объекта недвижимости
- `users_and_weights` — пока что коряво вот так сделанное хранилище того, какие юзеры какими метрами в объекте недвижимости владеют. В сумме должны быть равны площади объекта недвижимости.

4.2. в таблицу `tbot_section` пока что РУЧКАМИ завести группу (одну!) подъезда, в котором мы пока что работаем. Бот сейчас умеет работать только с группой, которая будет идти с айдишником = 1

```sqlite-sql
insert into tbot_section (id, chat_id, title) values (1, -716321959, 'Test group');
```

# Running

1. Убедиться, что переменная окружения `API_KEY` установлена (`echo $API_KEY`) иначе будет бадабум.
2. Запустить `python3 run_bot.py`
3. Постучаться к боту в тележеньке, может быть попереписываться с ним и узнать, что вы не верифицированы и идите нахуй
4. Зайти в базу, в таблицу `tbot_user`, найти появившегося себя и прописать себе `verified` в `1`. Заодно и вписать себя во владельцы какой-нибудь недвижиомсти в таблице `tbot_estate`

# Разработка

Ближайшая цель — выйти в продакшн, чтобы проводить ЭОСС-опросы в 10-ой секции Лесной 19к4. Сейчас три направления работы:

1. Сделать любую админку (на стандартных механизмах джанги может?) чтобы верифицировать пользователей и прописывать им объекты недвижимости
    - ~~сделать джанговскую админку~~
    - ~~сделать нормальные модели для связки пользователей и объектов недвижимости~~
    - исправить отображаемые имена для объектов недвижимости и пользователей в админке, чтобы заполнение данных не было адом
    - в идеале — найти способ отображать при создании/редактировании Estateowning-ов всю информацию о том, кто ещё владеет в какой доле указанным объектом недвижимости
2. Забить данные про 10-ю секцию
    - заполнить объекты недвижимости и площади
3. Обеспечить заполнение информации о том, кто является владельцами каких объектов недвижимости
    - ????
4. Сделать доку и презентационные материалы, чтобы когда мы выйдем в продакшн в 10-ой секции люди поняли как этим пользоваться и почему им это полезно
5. Выкатиться на сервак
    - выкатиться, запуститься
    - обеспечить домен
    - обеспечить бэкапы
    - в идеале — сделать CI прямо в гитхабе

Полезно, но не критично:

- Закатать в докер
- Отрефакторить костыли
- Сделать поддержку нескольких секций
